# Архитектура приложения

## Обзор

`django-webapps` — backend на Django, который предоставляет API (DRF) и админ‑интерфейс. Приложение состоит из нескольких Django‑приложений, работает с PostgreSQL и использует Redis для кеша/очередей.

## Основные компоненты

- `django_webapps/`: настройки проекта, маршрутизация, WSGI/ASGI.
- `api/`: основное приложение, содержит модели, сериализаторы, фильтры, представления и миграции.
- `alerts/`: логика алертов и фоновые задачи, связанные с мониторингом событий.
- `celery_config/`: конфигурация Celery и интеграция с Django.
- `devtools/`: вспомогательные инструменты для разработки.
- `templates/`, `static/`: шаблоны и статические ресурсы для админ‑панели.

## Поток обработки запросов

1. Клиент отправляет HTTP‑запрос в Django.
2. `urls.py` маршрутизирует запрос на соответствующий View/ViewSet в `api/`.
3. View использует сериализаторы для валидации входных данных и формирует ответ.
4. Данные читаются/записываются через модели Django, которые работают с PostgreSQL.
5. Для фильтрации и пагинации используются стандартные механизмы DRF и `django-filter`.

## Асинхронные задачи и алерты

- Celery используется для выполнения фоновых задач (например, периодических проверок и пересчета статусов).
- Redis выступает в роли брокера/бекенда задач.
- Логика алертов хранится в `alerts/` и обрабатывается отдельными воркерами.

## Alerts: назначение и поток обработки

Alerts предназначены для выявления важных событий и «зависаний» в процессах (например, онбординг, переходы статусов, просроченные действия) и их отражения в админ‑панели/дашборде.

Типичный поток:

1. Периодическая задача Celery запускает агрегацию/проверки.
2. Правила в `alerts/` анализируют состояние доменных сущностей и создают/обновляют записи алертов.
3. При изменении статуса объекта алерт может быть автоматически закрыт.

## Админ‑интерфейс

Основная UI‑точка — Django admin. Шаблоны админки размещены в `templates/`, статические файлы — в `static/`.

## Конфигурация и окружение

- Переменные окружения берутся из `.env` (шаблон — `.env.sample`).
- Зависимости управляются через `pyproject.toml` и `uv.lock`.

## Тестирование

Тесты пишутся на `pytest` с `pytest-django`. Основные API‑тесты находятся в `tests/tests_api/`.

## Высокоуровневые зависимости

- Django + Django REST Framework
- PostgreSQL (основная БД)
- Redis (кеш/очереди)
- Celery (фоновые задачи)
